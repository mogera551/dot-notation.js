class e{name;pathNames=[];parentPathNames=[];parentPath;regexp;level=0;constructor(e){this.name=e,this.pathNames=e.split("."),this.parentPathNames=this.pathNames.slice(0,-1),this.parentPath=this.parentPathNames.join("."),this.lastPathName=this.pathNames.at(-1),this.regexp=new RegExp("^"+e.replaceAll(".","\\.").replaceAll("*","([0-9a-zA-Z_]*)")+"$"),this.level=this.pathNames.filter((e=>"*"===e)).length}static create(t){const s=this.propertyNameByName.get(t);if(s)return s;const a=new e(t);return this.propertyNameByName.set(t,a),a}static propertyNameByName=new Map}class t{#e=[];#t;#s;#a;constructor(t){if(null==t)throw new Error("definedProperties is null");this.#t=new Set(t),this.#s=t.map((t=>e.create(t))),this.#a=new Map}get lastIndexes(){return this.#e[this.#e.length-1]}get stackIndexes(){return this.#e}get setOfDefinedProperties(){return this.#t}get definedPropertyNames(){return this.#s}get matchByName(){return this.#a}#r(t,s,a){let r;if(Reflect.has(t,s.name,a))r=Reflect.get(t,s.name,a);else{const h=this.#r(t,e.create(s.parentPath),a),i="*"===s.lastPathName?this.lastIndexes[s.level-1]:s.lastPathName;r=Reflect.get(h,i)}return r}#h(t,s,a,r){if(Reflect.has(t,s.name,r))Reflect.set(t,s.name,a,r);else{const h=this.#r(t,e.create(s.parentPath),r),i="*"===s.lastPathName?this.lastIndexes[s.level-1]:s.lastPathName;Reflect.set(h,i,a)}return!0}get(t,s,a){if(this.#t.has(s))return this.#r(t,e.create(s),a);const r=({propName:e,match:s})=>{this.#e.push(s.slice(1));try{return this.#r(t,e,a)}finally{this.#e.pop()}};if(this.#a.has(s))return r(this.#a.get(s));for(const e of this.#s){const t=e.regexp.exec(s);if(t)return this.#a.set(s,{propName:e,match:t}),r({propName:e,match:t})}throw new Error(`undefined property ${s}`)}set(t,s,a,r){if(this.#t.has(s))return this.#h(t,e.create(s),a,r);const h=({propName:e,match:s},a)=>{this.#e.push(s.slice(1));try{return this.#h(t,e,a,r)}finally{this.#e.pop()}};if(this.#a.has(s))return h(this.#a.get(s),a);for(const e of this.#s){const t=e.regexp.exec(s);if(t)return this.#a.set(s,{propName:e,match:t}),h({propName:e,match:t},a)}throw new Error(`undefined property ${s}`)}}export{t as Handler};
